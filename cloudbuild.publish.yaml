steps:
  - name: 'gcr.io/cloud-builders/npm'
    args: ['ci']
  - name: 'gcr.io/cloud-builders/npm'
    args: ['run', 'test']
  - name: 'gcr.io/cloud-builders/npm'
    args: ['run', 'bundle']
    env: ['NODE_ENV=production']
  - name: 'gcr.io/cloud-builders/npm'
    args: ['publish']
    env: ['NPM_CONFIG_USERCONFIG=./npmrc']
    secretEnv: ['NPM_TOKEN']

secrets:
- kmsKeyName: projects/rfh-prod/locations/global/keyRings/ci/cryptoKeys/NPM_TOKEN
  secretEnv:
    NPM_TOKEN: CiQAdaIEJ31IxPcFfOQklXlVvyEBa+hRtFFJ8ynfqlTX+4imQlASUQCBAGErS3SRBfY+OgwPu2fTR/TqTkCftmh9qhOcWYZozRbs/k3HArzQpDaHYrMaIEi7wyjnF0Er4W7libuub9e7eN+1l5OIbjyIZbevxZYvRw==
