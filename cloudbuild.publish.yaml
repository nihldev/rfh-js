steps:
  - name: 'gcr.io/cloud-builders/npm'
    args: ['i', '-D']
    secretEnv: ['NPM_TOKEN']
  - name: 'gcr.io/cloud-builders/npm'
    args: ['run', 'test']
    secretEnv: ['NPM_TOKEN']
  - name: 'gcr.io/cloud-builders/npm'
    args: ['run', 'bundle']
    env: ['NODE_ENV=production']
    secretEnv: ['NPM_TOKEN']
  - name: 'gcr.io/cloud-builders/npm'
    args: ['publish']
    secretEnv: ['NPM_TOKEN']

secrets:
- kmsKeyName: projects/rfh-production/locations/global/keyRings/npm-ci/cryptoKeys/token
  secretEnv:
    NPM_TOKEN: CiQAdaIEJ31IxPcFfOQklXlVvyEBa+hRtFFJ8ynfqlTX+4imQlASUQCBAGErS3SRBfY+OgwPu2fTR/TqTkCftmh9qhOcWYZozRbs/k3HArzQpDaHYrMaIEi7wyjnF0Er4W7libuub9e7eN+1l5OIbjyIZbevxZYvRw==
